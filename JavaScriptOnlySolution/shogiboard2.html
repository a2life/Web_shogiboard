<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
</head>
<body>
<div class="main">
    <p>hello world</p>
    <div class="forSnapshot">
        <div class="table"><!-- outer table -->
            <div class="row">
                <div id="boardbase" class="cell"><img class="board" src="images/boardandkoma/ban_kaya_a.png" alt="" /> <img class="board" src="images/boardandkoma/masu_dot_xy.png" alt="" /></div>
                <div class="cell"> </div>
                <!-- cell--></div>
            <!-- shogirow for the outer css-table--></div>
        <!--shogitable--> Here is a comment about this shogi board. if this spans below the shogi board and koma dai then it is a success!!!</div>
    <input id="aButton" type="button" value="javascript did not load" /> <input id="bButton" type="button" value="Jquery did not load" /> <input id="cButton" type="button" value="Board will not function" /></div>
<div><span>Shogi Resource</span> (<a href="http://www.muchonov.com/bona" rel="cc:attributionURL">muchonovski</a>) / <a href="http://creativecommons.org/licenses/by-nc/2.1/jp/" rel="license">CC BY-NC 2.1</a></div>
<!-- JavaScript at the bottom for fast page loading -->
<p> </p>
<!--  jQuery from jquery.com -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
function setupButton() {
    $("#aButton").click(function () {animateBoard()}).attr("value","Forward for solution");

}
function komatopng(koma) { switch (koma){ //convert piece information to image filename information.
    case 'p':return 'fu.png';
    case 'P':return 'to.png';
    case 'l': return 'kyo.png';
    case 'L': return 'nkyo.png';
    case 'n': return 'kei.png';
    case 'N': return 'nkei.png';
    case 's': return 'gin.png';
    case 'S': return 'ngin.png';
    case 'g': return 'kin.png';
    case 'b': return 'kaku.png';
    case 'B': return 'uma.png';
    case 'r': return 'hi.png';
    case 'R': return 'ryu.png';
    case 'k': return 'ou.png';
}
}

function postComment(comment) {$('#scomment').empty().append(comment);}
function emptyComment() {$('#scomment').empty();}
function cordToClass(cord){ return 'koma c'+cord.charAt(0)+' r'+cord.charAt(1);}
function cordToSelector(cord){return ('.koma.c'+cord.charAt(0)+'.r'+cord.charAt(1));}
function setMarker(cord){
    var markerClass;
    markerClass="marker c"+cord.charAt(0)+' r'+cord.charAt(1);
    $('#marker').attr("class",markerClass);
}
function makeAdrop(side,koma,position) {
    var png=side.toUpperCase()+komatopng(koma);
    if (side.toUpperCase()=='S') side='#senteMochigoma';
    else side='#goteMochigoma';
    setMarker(position);
    position=cordToClass(position);
    emptyComment();
    var selector=side+' [src$="'+png+'"]';
    $(selector).first().addClass(position).appendTo('#boardbase');
}
function captureKoma(side,cord){
    var komaban,koma;
    komaban=(side=='S')?'#senteMochigoma':'#goteMochigoma';
    koma=$(cordToSelector(cord)).data("koma");
    $(cordToSelector(cord)).first().attr("class","").attr("src",board.pathname+side+koma).appendTo(komaban);
}
function promoteKoma(side,cord) {
    var koma;

    koma = $(cordToSelector(cord)).data("koma");
    koma = (koma == "hi.png") ? "ryu.png" : koma = (koma == "kaku.png") ? "uma.png" : 'n' + koma;
    $(cordToSelector(cord)).first().attr("src", board.pathname + side + koma);
}
function makeAmove(side,promote, from, to) {
    emptyComment();
    if ($(cordToSelector(to)).length>0) captureKoma(side,to);
    setMarker(to);
    $(cordToSelector(from)).attr('class', cordToClass(to));
    if (promote=='+') {promoteKoma(side,to);}
}
function animateBoard(){
    var zAction=board.moves[board.index];
    parseAction(zAction);
    board.index+=1;
    if (board.moves[board.index].charAt(0)=='x')  $('#aButton').attr("disabled","disabled")
    ;
}
function parseAction(aAction) {

    if (aAction.charAt(0) == '*') postComment(aAction.slice(1));
    else {
        if (aAction.charAt(1) == 'd') makeAdrop(aAction.charAt(0), aAction.charAt(4), aAction.substr(2, 2));
        else {
            makeAmove(aAction.charAt(0).toUpperCase(), aAction.charAt(1), aAction.substr(4, 2), aAction.substr(2, 2));

        }
        if(aAction.indexOf('*')>0){postComment(aAction.slice(aAction.indexOf('*')+1))}
    }

}
function initializeBoard() {
    var i,cord,png;


    $('<img class="marker" id="marker" alt=""/>')
            .addClass(board.marker).attr('src', board.pathname  + board.markerColor + '.png').appendTo('#boardbase');

    for (i=0; i<board.onBoard.S.length; i++){

        png=komatopng(board.onBoard.S[i].charAt(2));
        cord=board.onBoard.S[i].substr(0,2);

        $('<img alt=""/>')
                .addClass(cordToClass(cord)).attr('src',board.pathname+'S'+png).attr('data-koma',png).appendTo('#boardbase');
    }
    for (i=0; i<board.onBoard.G.length; i++){

        png=komatopng(board.onBoard.G[i].charAt(2));
        cord=board.onBoard.G[i].substr(0,2);

        $('<img alt=""/>')
                .addClass(cordToClass(cord)).attr('src',board.pathname+'G'+png).attr('data-koma',png).appendTo('#boardbase');
    }

    for (i = 0; i < board.onHand.S.length; i++) {
        png=komatopng(board.onHand.S[i]);
        $('<img class="" alt=""/>')
                .attr('src', board.pathname+'S' + png ).attr('data-koma',png).appendTo('#senteMochigoma');
    }

    for (i = 0; i < board.onHand.G.length; i++) {
        png=komatopng(board.onHand.G[i]);
        $('<img class="" alt=""/>')
                .attr('src', board.pathname + 'G' + png).attr('data-koma',png).appendTo('#goteMochigoma');
    }

}
$(function () {
    initializeBoard();
    setupButton();

});
</script>
<script type="text/javascript" src="[[~262]]"></script>
<!-- end scripts -->
</body>
</html>